{{ $inputPayload := .Resources.Get "payload.yaml" | transform.Unmarshal }}
{{ $mergedPayload := partial "payload/build_base_payload"}}

{{ range $k, $v := $inputPayload }}
    {{ $mergedPayload = merge $mergedPayload (partial "payload/process_property" (dict "label" $k "value" $v)) }}
{{ end }}

{{ partial "payload/validate_payload" $mergedPayload }}

{{ return $mergedPayload }}